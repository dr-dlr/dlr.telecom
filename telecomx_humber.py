# -*- coding: utf-8 -*-
"""TelecomX_Humber.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/10nfyt29gacMc07MYfX-W43_QtuLFK2db

#游늷 Extracci칩n
"""

import pandas as pd
import matplotlib as plt
import seaborn as sns
import requests

response = requests.get('https://raw.githubusercontent.com/ingridcristh/challenge2-data-science-LATAM/refs/heads/main/TelecomX_Data.json')
data_json = response.json()

df_telecom = pd.json_normalize(data_json)

df_telecom.info()

df_telecom.head(2)

df_telecom.columns

df_telecom['account.Charges.Total'] = pd.to_numeric(df_telecom['account.Charges.Total'], errors='coerce')

df_telecom.info()

df_telecom.isnull().sum()

df_telecom["account.Charges.Total"] = df_telecom['account.Charges.Total'].fillna(0)

df_telecom.isnull().sum()

df_telecom.columns = df_telecom.columns.str.lower()

df_telecom.columns

df_telecom.sample()

"""#游댢 Transformaci칩n"""

df_telecom.sample(5)

df_telecom['cuentas_diarias'] = (df_telecom['account.charges.monthly'] / 30).round(2)

df_telecom[["churn", "customer.partner", "customer.dependents", "phone.phoneservice", "account.paperlessbilling"]]

columnas_binarias = ["churn", "customer.partner", "customer.dependents", "phone.phoneservice", "account.paperlessbilling"]

df_telecom[columnas_binarias] = df_telecom[columnas_binarias].replace({'Yes': 1, 'No': 0})

df_telecom.head(1)

df_telecom['churn'] = df_telecom['churn'].astype(bool)

df_telecom["churn"].dtype

df_telecom["churn"].value_counts()

"""#游늵 Carga y an치lisis"""

df_telecom.describe().round(2)

df_telecom.columns

conteo = df_telecom['churn'].value_counts()

import matplotlib.pyplot as plt
plt.figure(figsize=(10, 6))

ax = sns.countplot(x='churn', data=df_telecom, palette='viridis')

for container in ax.containers:
    ax.bar_label(container)

total = len(df_telecom)
bajas = df_telecom['churn'].sum()
porcentaje_bajas = (bajas / total) * 100

insight_general = (
    f"Se identifica que un {porcentaje_bajas:.1f}% de la base total de clientes\n"
    "ha cancelado el servicio. Aunque la mayor칤a (3/4) permanece,\n"
    "esta proporci칩n de evasi칩n es cr칤tica y requiere\n"
    "estrategias inmediatas de retenci칩n."
)

plt.text(0.95, 0.85, insight_general,
         fontsize=10, fontstyle='italic',
         bbox=dict(facecolor='white', alpha=0.7, edgecolor='gray', boxstyle='round,pad=1'),
         ha='right', va='top', transform=ax.transAxes)

plt.title('Distribuci칩n Global de Evasi칩n (Churn)')
plt.xlabel('Estado del Cliente')
plt.ylabel('N칰mero de Clientes')
plt.xticks([0, 1], ['Siguen Activos', 'Se dieron de baja'])

plt.tight_layout()
plt.show()

plt.pie(conteo, labels=['Permanecen', 'Evasi칩n'], autopct='%1.1f%%', startangle=90, colors=['#66b3ff','#ff9999'])
plt.title('Proporci칩n de Evasi칩n de Clientes (Churn)')
plt.show()

plt.figure(figsize=(10, 6))
ax = sns.countplot(x='customer.seniorcitizen', hue='churn', data=df_telecom, palette='magma')

insight_texto = (
    "Aunque el grueso de clientes son personas no adultas mayores,\n"
    "un 22.9% de estos se da de baja.\n"
    "Mientras que los adultos mayores a pesar de\n"
    "ocupar menos cantidad, su proporci칩n de bajas es del 40.3%"
)

plt.text(0.95, 0.85, insight_texto,
         fontsize=10,
         fontstyle='italic',
         bbox=dict(facecolor='white', alpha=0.7, edgecolor='gray', boxstyle='round,pad=1'),
         ha='right',
         va='top',
         transform=ax.transAxes)

plt.title('An치lisis de Evasi칩n: Segmento Senior')
plt.xlabel('쮼s Adulto Mayor? (0 = No, 1 = S칤)')
plt.ylabel('Cantidad de Clientes')

for container in ax.containers:
    ax.bar_label(container)

ax.set_xticklabels(['Otro segmento demogr치fico', 'Adultos mayores (65+)'])
plt.show()

plt.figure(figsize=(10, 6))

ax = sns.countplot(x='internet.internetservice', hue='churn', data=df_telecom, palette='Set2')

for container in ax.containers:
    ax.bar_label(container)

ax.set_xticklabels(['Internet DSL', 'Fibra 칍ptica', 'Sin Internet'])

# Nota: En este dataset, la Fibra 칍ptica suele tener la tasa de deserci칩n m치s alta.
insight_internet = (
    "A pesar de ser tecnolog칤a m치s r치pida, los clientes con Fibra 칍ptica\n"
    "presentan una tasa de evasi칩n sustancialmente mayor.\n"
    "Esto sugiere problemas de estabilidad o un precio percibido\n"
    "demasiado como alto."
)

plt.text(0.95, 0.85, insight_internet,
         fontsize=8,
         fontstyle='italic',
         bbox=dict(facecolor='white', alpha=0.7, edgecolor='gray', boxstyle='round,pad=1'),
         ha='right',
         va='top',
         transform=ax.transAxes)

plt.title('Tecnolog칤a de Internet VS Evasi칩n')
plt.xlabel('Tipo de Servicio Contratado')
plt.ylabel('Cantidad de Clientes')
plt.legend(title='Estado de Cliente', labels=['Se queda (0)', 'Se va (1)'])

plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 6))

ax = sns.boxplot(x='churn', y='cuentas_diarias', data=df_telecom, palette='pastel')

medianas = df_telecom.groupby('churn')['cuentas_diarias'].median()
for i, mediana in enumerate(medianas):
    plt.text(i, mediana, f'Mediana: {mediana:.2f}',
             ha='center', va='bottom', fontweight='bold', color='black')

insight_financiero = (
    "La mediana del gasto diario es notablemente superior\n"
    "en los clientes que abandonan el servicio (Churn=1).\n"
    "Esto indica que los clientes con facturas m치s altas son\n"
    "m치s sensibles al precio y tienen mayor tendencia a la evasi칩n."
)

plt.text(0.95, 0.90, insight_financiero,
         fontsize=10, fontstyle='italic',
         bbox=dict(facecolor='white', alpha=0.7, edgecolor='gray', boxstyle='round,pad=1'),
         ha='right', va='top', transform=ax.transAxes)

plt.title('Distribuci칩n de Gastos Diarios: 쯀nfluye el costo en la evasi칩n?')
plt.xlabel('Estado de Evasi칩n (0 = Permanecen, 1 = Abandonan)')
plt.ylabel('Costo Diario (USD)')
plt.xticks([0, 1], ['Siguen con nosotros', 'Se dieron de baja'])

plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 6))

sns.scatterplot(x='customer.tenure', y='account.charges.total', hue='churn', data=df_telecom, alpha=0.5)

plt.title('Relaci칩n entre Antig칲edad (Tenure) y Cargos Totales')
plt.xlabel('Meses de Antig칲edad (Tenure)')
plt.ylabel('Cargos Totales Acumulados')
plt.show()
# Quiz치 los que se quedan con planes caros creen que la antig칲edad es tal que ser칤a "inutil" cambiarse de empresa

columnas_interes = ['churn', 'cuentas_diarias', 'customer.tenure', 'customer.seniorcitizen',
                    'customer.partner', 'customer.dependents', 'account.charges.total']
matriz_corr = df_telecom[columnas_interes].corr()

sns.heatmap(matriz_corr, annot=True, cmap='coolwarm', fmt=".2f")
plt.title('Matriz de Correlaci칩n de Variables Cr칤ticas (Pearson)')
plt.show()

columnas_interes = ['churn', 'cuentas_diarias', 'customer.tenure', 'customer.seniorcitizen',
                    'customer.partner', 'customer.dependents', 'account.charges.total']
matriz_corr = df_telecom[columnas_interes].corr(method="kendall")

sns.heatmap(matriz_corr, annot=True, cmap='coolwarm', fmt=".2f")
plt.title('Matriz de Correlaci칩n de Variables Cr칤ticas (Kendall)')
plt.show()

columnas_interes = ['churn', 'cuentas_diarias', 'customer.tenure', 'customer.seniorcitizen',
                    'customer.partner', 'customer.dependents', 'account.charges.total']
matriz_corr = df_telecom[columnas_interes].corr(method="spearman")

sns.heatmap(matriz_corr, annot=True, cmap='coolwarm', fmt=".2f")
plt.title('Matriz de Correlaci칩n de Variables Cr칤ticas (Spearman)')
plt.show()

"""#游늯Informe final

# **An치lisis: Churn de Clientes - Telecom X**

***I. Introducci칩n***

El objetivo de este an치lisis es identificar los factores que detonan la evasi칩n de clientes (Churn) en la empresa de telecomunicaciones Telecom X.

La p칠rdida de clientes es un fen칩meno cr칤tico para cualquier empresa, en virtud de no solo representar una disminuci칩n en los ingresos directos, sino que tambi칠n incrementa los costos de adquisici칩n de nuevos usuarios y representa un potencial riesgo de p칠rdida de prestigio de cara a la opini칩n p칰blica por tomarse como un proveedor no confiable, caro o sin valor.

A trav칠s de este estudio se busca proporcionar al equipo de Data Science una base s칩lida de informaci칩n para el desarrollo de, estrategias, investigaciones y modelos predictivos que permitan mitigar la p칠rdida de clientes, revertirla y ejecutar planes de retenci칩n y fidelizaci칩n de clientes.

***II. Limpieza y Tratamiento de Datos (ETL)***

Para garantizar la integridad del an치lisis, se realiz칩 un proceso de Extracci칩n, Transformaci칩n y Carga estructurado:

2.1 Extracci칩n:

Los datos se obtuvieron en formato JSON desde una API y se transformaron en una estructura tabular plana utilizando la funci칩n de Pandas "pd.json_normalize".

2.2 Tratamiento de Tipos:

Para gantizar la correcta manipulaci칩n de los datos, primero se convirtieron columnas de tipo cadena a num칠ricas (espec칤ficamente account.charges.total).

2.3 Gesti칩n de Nulos:

Se identificaron 11 valores nulos en los cargos totales (clientes con 0 meses de antig칲edad), los cuales fueron imputados con el valor $0$ para que Pandas pudiera manejar de manera correcta la columna.

2.4 Ingenier칤a de Variables:

Se cre칩 la m칠trica "cuentas_diarias" para analizar el gasto a una escala m치s minuciosa. Adem치s, se transformaron las variables categ칩ricas de "Yes/No", que estaban en un formato de cadena (str) a formato binario (bool) "1/0" para permitir c치lculos estad칤sticos y correlaciones.

***III. An치lisis Exploratorio de Datos (EDA)***

A trav칠s de las visualizaciones hechas con matplotlib (plt) y seaborn (sns), se lograron detectar patrones clave, mismos que a continuaci칩n se describen:

3.1 Distribuci칩n General:

La tasa de evasi칩n es significativa, concentrada principalmente en los primeros meses de relaci칩n con el cliente (Tenure bajo).

3.2 Segmento Senior:

Los adultos mayores presentan una tasa de deserci칩n del 40.3%, casi el doble que el resto de los clientes, que en su conjunto hacen un 22.9%.

3.3 Factor Tecnol칩gico:

Se encontr칩 que los usuarios de Fibra 칍ptica se van con m치s frecuencia que los que est치n conectados por DSL, lo que sugiere una insatisfacci칩n con el precio o la estabilidad de este servicio en lo espec칤fico.

3.4 Factor Financiero:

El gr치fico de caja y bigote (Boxplot) confirm칩 que los clientes que abandonan la empresa tienen una mediana de gasto diario superior a los que permanecen.

***IV. Exploraci칩n de Correlaci칩n***

Para medir qu칠 factores tienen mayor impacto, se calcul칩 una matriz de correlaci칩n con las variables de mayor inter칠s.

**4.1 An치lisis de Correlaci칩n (Pearson, Kendall y Spearman):**

Relaci칩n Cuenta Diaria vs. Churn: Se encontr칩 que existe una correlaci칩n positiva. A medida que aumenta el costo diario, aumenta la probabilidad de Churn, sin embargo esta correlaci칩n encontrada fue de tipo muy d칠bil (0.19), por lo que no es de importancia estad칤stica para su estudio.

Por otra parte, las correlaciones con mayor fuerza fueron cuentas diarias y total acumulado de cargos, con una fuerza de correlaci칩n fuerte (0.65), aunque **la de mayor trascendencia y de mayor inter칠s que se detect칩, tiene que ver entre la antig칲edad y los cargos totales, con una correlaci칩n positiva muy fuerte (0.83).**

Esto confirma que el tiempo de permanencia es el factor determinante del ingreso acumulado por cliente. Por lo tanto, cualquier estrategia que aumente el 'tenure' por tan solo unos meses tendr치 un impacto directo y predecible en la facturaci칩n total de la compa침칤a.

Perder a un cliente con alto tenure es un golpe financiero mucho m치s significativo que perder a uno nuevo, toda vez que un cliente de 60 meses de antig칲edad ha aportado proporcionalmente mucho m치s capital que 10 clientes nuevos. La correlaci칩n de 0.83 valida que retener es m치s barato y rentable que adquirir, lo que delinea por s칤 mismo las acciones que debe tomar la empresa.

4.2 Servicios Contratados:

Un hallazgo com칰n es que los clientes con pocos servicios adicionales (como seguridad en l칤nea o soporte t칠cnico) tienden a irse m치s r치pido; o visto de otra manera, a raz칩n de m치s servicios contratados, es mayor la permanencia del cliente.

***V. Conclusiones e Insights***

El precio es un detonante: El an치lisis de cuentas diarias demuestra que los clientes con facturas m치s altas son los m치s propensos a abandonar.

Fidelizaci칩n temprana: La correlaci칩n negativa entre tenure y churn indica que mientras m치s tiempo se logre retener a un cliente, menor es su probabilidad de irse.

Riesgo en Fibra 칍ptica: Es el servicio con mayor volumen de bajas, lo que indica un problema de competitividad o costo en ese producto.

***VI. Recomendaciones Estrat칠gicas***

Establecer un programa de lealtad a clientes senior: Crear planes preferenciales o asistencia t칠cnica especializada para adultos mayores para reducir su tasa de fuga del 40%. Asimismo, valdr칤a la pena investigar la familiaridad que tienen los clientes de este segmento etario con el servicio provisto.

Auditor칤a de Fibra 칍ptica: Investigar si la alta evasi칩n en este servicio se debe a fallas t칠cnicas, si el precio es demasiado elevado comparado con la competencia o una mezcla de ambas causas.

Incentivos por Permanencia: Implementar descuentos autom치ticos o beneficios adicionales cuando el cliente cumple sus primeros 6 y 12 meses (etapa de mayor riesgo).
"""